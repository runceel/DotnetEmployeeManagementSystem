# MCPチャット UI設計・画面構成

**Issue**: BlazorWeb（UI/チャット）：MCPサーバー連携・動作検証  
**作成日**: 2024-11-24  
**実装ステータス**: 完了

## 画面構成概要

MCPチャット機能は、MudBlazorコンポーネントを使用した最新のマテリアルデザインUIで実装されています。

### アクセスURL
```
/mcp-chat
```

### ナビゲーション
左側メニューに「MCPチャット」リンクが追加され、チャットアイコン（💬）で識別可能です。

## 画面レイアウト

### 1. 初期画面（未接続状態）

```
┌────────────────────────────────────────────────────────────────┐
│ ナビゲーションメニュー                                           │
│  ホーム / ダッシュボード / 従業員管理 / 部署管理 / 勤怠管理      │
│  通知管理 / [MCPチャット] ← 新規追加                            │
└────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│  💬 MCPチャット - 統合サービス操作                               │
└────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│  📡 MCPサーバーに接続                                           │
│                                                                 │
│  従業員管理システムの各サービスにMCP経由で接続します。           │
│  接続後、自然言語での操作が可能になります。                      │
│                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────┐│
│  │ 👥          │  │ 🛡️          │  │ 🔔          │  │ 🕐     ││
│  │ 従業員      │  │ 認証        │  │ 通知        │  │ 勤怠   ││
│  │ サービス    │  │ サービス    │  │ サービス    │  │ サービス││
│  │             │  │             │  │             │  │        ││
│  │ 従業員と部署│  │ ユーザーと  │  │ システム通知│  │ 勤怠記録││
│  │ の管理機能  │  │ ロールの管理│  │ の管理機能  │  │ と休暇 ││
│  └─────────────┘  └─────────────┘  └─────────────┘  └────────┘│
│                                                                 │
│  [  🔗 全サービスに接続  ] ← 大きなプライマリボタン              │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

**使用コンポーネント**:
- `MudCard` - 接続パネル全体
- `MudGrid` / `MudItem` - サービスカードのレイアウト
- `MudCard` (Outlined) - 各サービスカード
- `MudIcon` - サービスアイコン
- `MudButton` (Filled, Primary) - 接続ボタン

### 2. メイン画面（接続後）

```
┌────────────────────────────────────────────────────────────────────────────┐
│  💬 MCPチャット - 統合サービス操作                                           │
└────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────┬──────────────────────────────────────────────────────┐
│  接続状態           │  チャット履歴                                 🗑️      │
│  🔄 更新  🔗 切断  │                                                         │
├─────────────────────┤  ┌──────────────────────────────────────────────┐   │
│ ✅ 従業員サービス   │  │                                              │   │
│    (8 ツール)       │  │   [システム] 4個のサーバーに接続しました      │   │
│                     │  │   09:15:32                                   │   │
│ ✅ 認証サービス     │  │                                              │   │
│    (6 ツール)       │  │                     [あなた] ツールを実行    │   │
│                     │  │                     ListEmployeesAsync      │   │
│ ✅ 通知サービス     │  │                     引数: {}                │   │
│    (4 ツール)       │  │                     09:16:10                │   │
│                     │  │                                              │   │
│ ✅ 勤怠サービス     │  │   [システム] ✅ 実行結果:                    │   │
│    (10 ツール)      │  │   {                                          │   │
├─────────────────────┤  │     "employees": [...],                      │   │
│                     │  │     "totalCount": 25                         │   │
│  利用可能なツール   │  │   }                                          │   │
│  [従業員サービス]   │  │   09:16:11                                   │   │
│                     │  │                                              │   │
│  🔧 ListEmployees...│  └──────────────────────────────────────────────┘   │
│     全従業員の一覧  │                                                         │
│     を取得          │  ツール実行                                             │
│                     │  ℹ️ ListEmployeesAsync: 全従業員の一覧を取得します       │
│  🔧 GetEmployee...  │                                                         │
│     指定された従業員│  引数 (JSON形式)  ▼                                     │
│     IDの詳細情報    │  ┌────────────────────────────────────────────────┐  │
│                     │  │ {}                                              │  │
│  🔧 SearchEmployee..│  │                                                 │  │
│     メールアドレス  │  └────────────────────────────────────────────────┘  │
│     で検索          │                                                         │
│                     │  [▶️ ツールを実行]                                      │
│  🔧 CreateEmployee..│                                                         │
│  🔧 UpdateEmployee..│                                                         │
│  🔧 DeleteEmployee..│                                                         │
└─────────────────────┴──────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│  ❓ 使い方ガイド                                                             │
│  ▼ クリックして展開                                                          │
└────────────────────────────────────────────────────────────────────────────┘
```

**レイアウト構造**:
- 左側パネル (4カラム): サーバー管理とツールリスト
- 右側パネル (8カラム): チャット履歴とツール実行
- 下部: 展開可能なヘルプセクション

**使用コンポーネント**:
- `MudGrid` / `MudItem` - 2カラムレイアウト
- `MudCard` - 各パネル
- `MudList` - サーバーリスト、ツールリスト
- `MudListItem` - 各アイテム
- `MudPaper` - チャットメッセージ
- `MudTextField` - JSON入力欄
- `MudButton` - アクションボタン
- `MudExpansionPanels` - ヘルプセクション

### 3. ヘルプセクション展開時

```
┌────────────────────────────────────────────────────────────────────────────┐
│  ❓ 使い方ガイド                                                      ▲ 閉じる│
├────────────────────────────────────────────────────────────────────────────┤
│  MCPチャットの使い方                                                         │
│                                                                             │
│  ● 1. サーバー選択: 左側のリストから操作したいサービスを選択します          │
│  ● 2. ツール選択: 選択したサービスの利用可能なツール一覧から実行したい操作を│
│       選びます                                                               │
│  ● 3. 引数入力: JSON形式でツールに必要な引数を入力します                    │
│  ● 4. 実行: 「ツールを実行」ボタンをクリックして操作を実行します            │
│  ● 5. 結果確認: チャット履歴に実行結果が表示されます                        │
│                                                                             │
│  JSON引数の例                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 従業員取得:                                                          │  │
│  │ {"employeeId": "your-guid-here"}                                     │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │ 従業員作成:                                                          │  │
│  │ {"firstName": "太郎", "lastName": "山田",                            │  │
│  │  "email": "taro@example.com", "departmentId": "dept-guid",           │  │
│  │  "position": "エンジニア", "hireDate": "2024-01-01"}                 │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────────────┘
```

## カラースキーム

### プライマリカラー
- **ボタン**: MudBlazor Primary（青）
- **成功**: MudBlazor Success（緑）
- **エラー**: MudBlazor Error（赤）
- **警告**: MudBlazor Warning（オレンジ）

### メッセージカラー
- **ユーザーメッセージ**: `#1976d2`（青背景、白文字）
- **システムメッセージ**: `#f5f5f5`（グレー背景、黒文字）

### アイコン
- 従業員サービス: `mdi-account-group`（👥）
- 認証サービス: `mdi-shield-account`（🛡️）
- 通知サービス: `mdi-bell`（🔔）
- 勤怠サービス: `mdi-clock-outline`（🕐）
- ツール: `mdi-build`（🔧）
- 接続: `mdi-link`（🔗）
- 更新: `mdi-refresh`（🔄）
- 削除: `mdi-delete`（🗑️）

## レスポンシブデザイン

### デスクトップ (md以上)
- 左パネル: 4カラム（33%）
- 右パネル: 8カラム（67%）
- チャット履歴高さ: 500px

### タブレット (sm)
- 左パネル: 6カラム（50%）
- 右パネル: 6カラム（50%）

### モバイル (xs)
- 左パネル: 12カラム（100%、上部）
- 右パネル: 12カラム（100%、下部）
- 縦スタック配置

## インタラクション

### 接続ボタン
- **通常**: 青背景、白文字
- **接続中**: スピナー表示、"接続中..."テキスト
- **無効化**: グレーアウト

### ツール実行ボタン
- **通常**: 緑背景、白文字、▶️アイコン
- **実行中**: スピナー表示、"実行中..."テキスト
- **無効化**: ツール未選択時

### チャットメッセージ
- **ユーザー**: 右寄せ、青背景
- **システム**: 左寄せ、グレー背景
- **アニメーション**: 追加時にフェードイン（StateHasChanged）

### エラー表示
- `MudAlert` (Severity.Error) - 赤背景
- ツール実行パネル下部に表示
- アイコン: ⚠️

## アクセシビリティ

### ARIA属性
- ボタン: `aria-label` で操作内容を明示
- アイコン: `title` 属性（MudBlazorの制限により削除済み）

### キーボード操作
- タブキーでフォーカス移動
- エンターキーでボタン実行

### コントラスト
- WCAG AA準拠を目指した配色
- テキストとバックグラウンドのコントラスト比 4.5:1以上

## パフォーマンス最適化

### 仮想スクロール
- ツールリストが多い場合は `MudList` の仮想化を検討

### 状態管理
- `StateHasChanged()` を適切なタイミングで呼び出し
- 不要な再レンダリングを防止

### メモリ管理
- `IAsyncDisposable` 実装
- サービスのDisposeで接続を適切にクローズ

## 今後の改善案

### UI/UX
1. **JSON エディター統合**
   - Monaco Editor または Ace Editor
   - シンタックスハイライト
   - バリデーション機能

2. **ダークモード対応**
   - MudBlazor の ThemeProvider 利用
   - ユーザー設定保存

3. **ツール検索機能**
   - ツール名・説明での絞り込み
   - インクリメンタルサーチ

4. **お気に入り機能**
   - よく使うツールをブックマーク
   - LocalStorage に保存

5. **履歴機能**
   - 過去の実行結果を保存
   - 引数の再利用

### 機能拡張
1. **バッチ実行**
   - 複数ツールの連続実行
   - ワークフロー定義

2. **結果エクスポート**
   - JSON/CSV ダウンロード
   - クリップボードコピー

3. **通知統合**
   - リアルタイム通知の表示
   - SignalR 統合

## コンポーネント一覧

実装で使用したMudBlazorコンポーネント:

| コンポーネント | 用途 |
|--------------|------|
| MudContainer | ページ全体のコンテナ |
| MudText | テキスト表示 |
| MudCard | パネル・カード |
| MudCardHeader | カードヘッダー |
| MudCardContent | カード本体 |
| MudGrid / MudItem | レスポンシブレイアウト |
| MudButton | ボタン |
| MudIconButton | アイコンボタン |
| MudList | リスト表示 |
| MudListItem | リストアイテム |
| MudIcon | アイコン |
| MudAlert | 警告・エラー表示 |
| MudTextField | テキスト入力 |
| MudPaper | 紙のようなコンテナ |
| MudChip | ラベル表示 |
| MudExpansionPanels | 展開可能パネル |
| MudExpansionPanel | 個別パネル |
| MudProgressCircular | スピナー |

---

**作成日**: 2024-11-24  
**実装ステータス**: ✅ 完了  
**ビルド**: ✅ 成功  
**実機テスト**: ⏳ Aspire環境セットアップ推奨
