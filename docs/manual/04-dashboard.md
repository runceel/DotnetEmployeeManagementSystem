# 第4章: ダッシュボード

## 4.1 概要

ダッシュボードは、従業員管理システムの中心的な画面です。システム全体の概要を一目で把握でき、重要な統計情報や最近のアクティビティを確認できます。

**アクセス方法:**
- メニューバーの「ダッシュボード」をクリック
- またはURL: `/dashboard` に直接アクセス

## 4.2 画面構成

ダッシュボード画面は、以下の4つの主要セクションで構成されています：

```
┌──────────────────────────────────────────────────────────────────┐
│ ダッシュボード                                                     │
│ システムの概要と統計情報                                           │
├────────────────┬────────────────┬────────────────┬────────────────┤
│ 統計カード 1   │ 統計カード 2   │ 統計カード 3   │ 統計カード 4   │
├──────────────────────────────────────┬───────────────────────────┤
│ 最近の活動                            │ クイックアクション         │
│                                      │                           │
│                                      ├───────────────────────────┤
│                                      │ システムステータス         │
└──────────────────────────────────────┴───────────────────────────┘
```

## 4.3 統計カード

画面上部には4つの統計カードが表示され、システムの主要な指標をリアルタイムで確認できます。

### 4.3.1 総従業員数

**表示内容:**
- 現在システムに登録されている全従業員の数
- データベースから動的に取得

**色:** 青（Primary）

**用途:**
- 組織全体の規模を把握
- 人員計画の参考指標

### 4.3.2 アクティブユーザー

**表示内容:**
- 現在システムにログインしているユーザーの数
- ※現在は暫定的に総従業員数の約30%を表示

**色:** 緑（Success）

**用途:**
- システム利用状況の把握
- ピーク時間帯の分析

**注意:**
> 将来的には認証サービス（AuthService）と連携し、実際のアクティブセッション数を表示予定です。

### 4.3.3 部署数

**表示内容:**
- 登録されているユニークな部署の総数
- 従業員の部署フィールドから計算

**色:** 水色（Info）

**用途:**
- 組織構造の把握
- 部署別管理の参考情報

### 4.3.4 今月の新規登録

**表示内容:**
- 当月に新規登録された従業員の数
- 月初（1日00:00:00）から現在までの集計

**色:** オレンジ（Warning）

**用途:**
- 採用活動の進捗管理
- 月次トレンドの把握

## 4.4 最近の活動

画面左側のセクションには、システム内で最近発生したアクティビティがタイムライン形式で表示されます。

### 4.4.1 表示される活動

**新規従業員登録（緑色のアイコン）**
- 従業員が新しく登録された際に表示
- 表示例: 「山田 太郎さんが登録されました」

**情報更新（青色のアイコン）**
- 既存従業員の情報が更新された際に表示
- 表示例: 「佐藤 花子さんの情報が更新されました」

### 4.4.2 相対時間表示

各アクティビティには、発生からの経過時間が日本語で表示されます：

| 経過時間 | 表示 |
|---------|------|
| 1分未満 | たった今 |
| 1時間未満 | ○○分前 |
| 24時間未満 | ○○時間前 |
| 7日未満 | ○○日前 |
| 30日未満 | ○○週間前 |
| 365日未満 | ○○ヶ月前 |
| 365日以上 | ○○年前 |

### 4.4.3 表示件数

デフォルトで最新5件のアクティビティが表示されます。

**アクティビティがない場合:**
> 「最近のアクティビティはありません」と表示されます。

## 4.5 クイックアクション

画面右上のセクションには、よく使う機能へのショートカットボタンが配置されています。

### 利用可能なアクション

1. **新規従業員登録** 📝
   - 新しい従業員をシステムに登録
   - ※現在開発中のため無効化されています

2. **従業員検索** 🔍
   - 従業員情報を検索
   - ※現在開発中のため無効化されています

3. **レポート生成** 📊
   - 各種レポートの作成と出力
   - ※現在開発中のため無効化されています

4. **設定** ⚙️
   - システム設定の変更
   - ※現在開発中のため無効化されています

> **注意:** これらの機能は将来のバージョンで有効化される予定です。

## 4.6 システムステータス

画面右下のセクションには、各マイクロサービスの稼働状態が表示されます。

### 監視対象サービス

1. **従業員サービス**
   - EmployeeService API の健全性
   - エンドポイント: `/health`

2. **認証サービス**
   - AuthService API の健全性
   - エンドポイント: `/health`

3. **データベース**
   - データベース接続の状態
   - ※現在は常に「正常」と表示

### ステータス表示

| ステータス | アイコン | 意味 |
|-----------|---------|------|
| 正常 | ✅ チェックマーク（緑） | サービスが正常に稼働中 |
| エラー | ❌ エックス（赤） | サービスでエラーが発生 |
| 接続不可 | ⚠️ 警告（黄） | サービスに接続できない |

## 4.7 データのリフレッシュ

### 4.7.1 自動リフレッシュ

ダッシュボードのデータは、画面を開いたタイミング（`OnInitializedAsync`）で自動的に取得されます。

### 4.7.2 手動リフレッシュ

最新のデータを確認したい場合は、以下の方法でリフレッシュできます：

**方法1: ページ再読み込み**
- ブラウザの更新ボタンをクリック
- または `F5` キーを押す
- または `Ctrl + R` (Windows/Linux) / `Cmd + R` (Mac)

**方法2: 画面遷移**
- 一旦他のページに移動してから、再びダッシュボードに戻る

### 4.7.3 データ取得のタイミング

```
┌─────────────────────────────────────────────────────┐
│ 1. ページ読み込み開始                                │
│    ↓                                                │
│ 2. ローディング表示（スケルトンローダー）            │
│    ↓                                                │
│ 3. API呼び出し                                      │
│    - 統計情報の取得                                 │
│    - 最近のアクティビティの取得                     │
│    - サービスステータスのチェック                   │
│    ↓                                                │
│ 4. データ表示                                       │
└─────────────────────────────────────────────────────┘
```

## 4.8 ローディング状態

### 4.8.1 スケルトンローダー

データ取得中は、各統計カードにスケルトンローダー（グレーのアニメーション）が表示されます。これにより、ユーザーはデータ読み込み中であることを視覚的に確認できます。

**表示箇所:**
- 4つの統計カード
- 読み込みが完了すると、実際のデータに置き換わります

### 4.8.2 読み込み時間

通常、データの読み込みは以下の時間で完了します：

- **統計情報:** 100-300ミリ秒
- **アクティビティ:** 100-300ミリ秒
- **サービスステータス:** 200-500ミリ秒

**合計:** 約0.5秒～1秒程度

> ネットワーク状況やデータベースの負荷によって変動します。

## 4.9 エラーハンドリング

### 4.9.1 エラー表示

データ取得に失敗した場合、画面上部に赤いエラーメッセージが表示されます。

**表示例:**
```
⚠️ データの取得に失敗しました。
   [具体的なエラーメッセージ]
```

### 4.9.2 エラー発生時の対処法

1. **ネットワーク接続を確認**
   - インターネット接続が正常か確認
   - 社内ネットワークに接続されているか確認

2. **ページをリフレッシュ**
   - ブラウザの更新ボタンをクリック
   - 一時的な問題の場合、解決する可能性があります

3. **サービスステータスを確認**
   - 画面下部の「システムステータス」セクションを確認
   - どのサービスで問題が発生しているか特定

4. **システム管理者に連絡**
   - 問題が継続する場合は、システム管理者に連絡
   - エラーメッセージの内容を伝える

### 4.9.3 一般的なエラーと原因

| エラーメッセージ | 考えられる原因 | 対処法 |
|----------------|--------------|--------|
| 従業員一覧の取得に失敗しました | EmployeeService が停止 | サービスの再起動 |
| 接続がタイムアウトしました | ネットワーク問題 | 接続を確認 |
| サーバーエラーが発生しました | データベース接続問題 | DB接続を確認 |

## 4.10 パフォーマンスに関する注意

### 4.10.1 データ量の影響

ダッシュボードのパフォーマンスは、以下の要因に影響されます：

- **従業員数:** 数千人規模でも高速に動作するよう最適化済み
- **アクティビティ数:** 直近5件のみ取得するため影響は最小限
- **ネットワーク速度:** API呼び出しのレスポンス時間に影響

### 4.10.2 最適化されたクエリ

統計情報の計算は、効率的なデータベースクエリによって実行されます：

```sql
-- 総従業員数: 単純なカウント
SELECT COUNT(*) FROM Employees

-- 部署数: ユニークな部署名のカウント
SELECT COUNT(DISTINCT Department) FROM Employees

-- 今月の新規登録: 条件付きカウント
SELECT COUNT(*) FROM Employees 
WHERE CreatedAt >= @MonthStart
```

## 4.11 よくある質問（FAQ）

### Q1: アクティブユーザー数が実際と異なるのはなぜですか？

**A:** 現在は暫定的な計算方法（総従業員数の30%）を使用しています。将来のバージョンで認証サービスとの連携により、実際のログインセッション数を表示予定です。

### Q2: ダッシュボードのデータはリアルタイムで更新されますか？

**A:** 現在は自動更新機能はありません。最新のデータを確認するには、ページをリフレッシュする必要があります。将来的にはSignalRを使用したリアルタイム更新を実装予定です。

### Q3: クイックアクションのボタンが押せないのはなぜですか？

**A:** これらの機能は現在開発中です。将来のバージョンで有効化され、それぞれの機能ページに遷移できるようになります。

### Q4: 「今月の新規登録」はいつリセットされますか？

**A:** 毎月1日の00:00:00（UTC）に自動的にリセットされ、新しい月の集計が開始されます。

### Q5: システムステータスが「接続不可」と表示されます

**A:** 該当するマイクロサービスが停止しているか、ネットワーク問題が発生している可能性があります。システム管理者に連絡してください。

### Q6: 最近の活動が何も表示されません

**A:** システムに従業員が登録されていない場合や、すべての従業員が古いデータの場合、アクティビティは表示されません。新しく従業員を登録または更新すると、アクティビティが表示されるようになります。

## 4.12 技術情報（開発者向け）

> このセクションは、システムのカスタマイズやトラブルシューティングを行う技術者向けの情報です。

### 4.12.1 API エンドポイント

ダッシュボードは以下のAPIエンドポイントを使用します：

**統計情報取得:**
```http
GET /api/employees/dashboard/statistics
```

**レスポンス:**
```json
{
  "totalEmployees": 42,
  "departmentCount": 8,
  "newEmployeesThisMonth": 5
}
```

**最近のアクティビティ取得:**
```http
GET /api/employees/dashboard/recent-activities?count=5
```

**レスポンス:**
```json
[
  {
    "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
    "activityType": "Created",
    "employeeId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
    "employeeName": "山田 太郎",
    "description": "山田 太郎さんが登録されました",
    "timestamp": "2024-11-08T12:34:56Z"
  }
]
```

### 4.12.2 コンポーネント構造

```
Dashboard.razor
├── OnInitializedAsync()
│   ├── GetDashboardStatisticsAsync()
│   ├── GetRecentActivitiesAsync(5)
│   └── CheckServicesStatus()
├── 統計カード × 4
├── 最近の活動タイムライン
├── クイックアクション
└── システムステータス
```

### 4.12.3 カスタマイズポイント

- **表示件数の変更:** `GetRecentActivitiesAsync()` の引数を変更
- **更新間隔の設定:** タイマーを実装して自動更新を追加可能
- **統計項目の追加:** 新しいDTOプロパティとAPIエンドポイントを追加

## 4.13 将来の機能拡張予定

以下の機能が将来のバージョンで実装される予定です：

- ✅ **グラフ表示:** 部署別従業員数の円グラフ
- ✅ **トレンド分析:** 月次の採用トレンドを折れ線グラフで表示
- ✅ **リアルタイム更新:** SignalRによる自動データ更新
- ✅ **カスタマイズ可能なウィジェット:** ユーザーが表示項目を選択可能
- ✅ **エクスポート機能:** ダッシュボードデータのPDF/Excel出力
- ✅ **在籍期間の分析:** 従業員の平均在籍期間の表示
- ✅ **アクティブユーザーの実数表示:** AuthServiceとの連携

## 4.14 まとめ

ダッシュボードは、従業員管理システムの重要な情報を一元的に表示する中心的な画面です。リアルタイムの統計情報、最近のアクティビティ、システムステータスを確認することで、組織の状況を常に把握できます。

**ダッシュボードを効果的に活用するために:**

1. 📊 **定期的な確認:** 毎日の業務開始時にダッシュボードを確認する習慣をつける
2. 🔄 **データのリフレッシュ:** 重要な判断をする前に最新データに更新
3. ⚠️ **ステータス監視:** システムステータスに異常がないか確認
4. 📈 **トレンド把握:** 「今月の新規登録」などから組織の変化を読み取る

---

**関連ドキュメント:**
- [第1章: はじめに](./01-introduction.md)（未作成）
- [第2章: ログイン](./02-login.md)（未作成）
- [第3章: ホーム画面](./03-home.md)（未作成）
- [第5章: 従業員管理](./05-employees.md)（未作成）
- [開発者ガイド](../development-guide.md)
- [アーキテクチャ詳細設計書](../architecture-detailed.md)

**最終更新日:** 2025-11-10  
**対象バージョン:** .NET 9 / Aspire 9.5.2
