@page "/"
@using BlazorWeb.Services
@inject AuthStateService AuthStateService
@implements IDisposable

<PageTitle>ホーム - 従業員管理システム</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">従業員管理システムへようこそ</MudText>

@if (AuthStateService.IsAuthenticated)
{
    <MudAlert Severity="Severity.Success" Class="mb-4">
        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Class="mr-2" />
        ログイン中: <strong>@AuthStateService.CurrentUser?.UserName</strong> (@AuthStateService.CurrentUser?.Email)
    </MudAlert>
}
else
{
    <MudAlert Severity="Severity.Info" Class="mb-4">
        <MudIcon Icon="@Icons.Material.Filled.Info" Class="mr-2" />
        ログインしていません。<MudLink Href="/login">ログインページ</MudLink>からログインしてください。
    </MudAlert>
}

<MudText Typo="Typo.body1" GutterBottom="true">
    このアプリケーションは、従業員情報を効率的に管理するためのシステムです。
</MudText>

<MudGrid Class="mt-4">
    <MudItem xs="12" sm="6" md="4">
        <MudCard>
            <MudCardContent>
                <MudText Typo="Typo.h5" Class="mb-2">
                    <MudIcon Icon="@Icons.Material.Filled.Dashboard" /> ダッシュボード
                </MudText>
                <MudText Typo="Typo.body2">
                    システムの概要と重要な統計情報を確認できます。
                </MudText>
            </MudCardContent>
            <MudCardActions>
                <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/dashboard">開く</MudButton>
            </MudCardActions>
        </MudCard>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudCard>
            <MudCardContent>
                <MudText Typo="Typo.h5" Class="mb-2">
                    <MudIcon Icon="@Icons.Material.Filled.People" /> 従業員管理
                </MudText>
                <MudText Typo="Typo.body2">
                    従業員情報の登録、編集、検索を行えます。
                </MudText>
            </MudCardContent>
            <MudCardActions>
                <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/employees">開く</MudButton>
            </MudCardActions>
        </MudCard>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudCard>
            <MudCardContent>
                <MudText Typo="Typo.h5" Class="mb-2">
                    <MudIcon Icon="@Icons.Material.Filled.Security" /> 認証
                </MudText>
                <MudText Typo="Typo.body2">
                    ユーザー認証とアクセス管理を行います。
                </MudText>
            </MudCardContent>
            <MudCardActions>
                @if (AuthStateService.IsAuthenticated)
                {
                    <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="HandleLogout">ログアウト</MudButton>
                }
                else
                {
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/login">ログイン</MudButton>
                }
            </MudCardActions>
        </MudCard>
    </MudItem>
</MudGrid>

<MudDivider Class="my-4" />

<MudText Typo="Typo.h4" GutterBottom="true">機能概要</MudText>
<MudList T="string">
    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
        MudBlazorによるモダンなUI
    </MudListItem>
    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
        .NET Aspireによるマイクロサービス統合
    </MudListItem>
    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
        従業員サービスとの連携（実装済み）
    </MudListItem>
    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
        認証サービスとの連携（実装済み）
    </MudListItem>
</MudList>

@code {
    protected override void OnInitialized()
    {
        AuthStateService.OnAuthStateChanged += StateHasChanged;
    }

    private void HandleLogout()
    {
        AuthStateService.Logout();
    }

    public void Dispose()
    {
        AuthStateService.OnAuthStateChanged -= StateHasChanged;
    }
}
